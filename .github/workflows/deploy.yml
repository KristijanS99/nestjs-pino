name: Create or Update Latest Tag and Build

on:
  push:
    branches:
      - master

jobs:
  create-or-update-latest-tag-and-build:
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16  # Change this to your desired Node.js version

      - name: Install Dependencies
        run: npm install  # Use yarn install or your preferred package manager

      - name: Build
        run: npm run build  # Replace with your build command

      - name: Create Release Artifact
        run: |
          # Create a release artifact (e.g., a ZIP or tar.gz file) from your build output, README, and package.json
          # Copy the contents of 'dist' to the root of the artifact
          # Replace 'dist' with the appropriate paths
          mkdir release-artifact
          cp -r dist/* release-artifact/
          cp README.md package.json release-artifact/
          zip -r release-artifact.zip release-artifact/

      - name: Upload Release Artifact
        uses: actions/upload-artifact@v2
        with:
          name: release-artifact
          path: release-artifact.zip

      - name: Extract Artifact and Create Tag
        run: |
          TAG_NAME="latest"
          ARTIFACT_DIR="artifact-contents"
          
          # Create a directory for the artifact contents
          mkdir $ARTIFACT_DIR
          
          # Download and extract the artifact
          curl -L -o artifact.zip https://github.com/$GITHUB_REPOSITORY/actions/artifacts/<artifact-id>/zip
          unzip -q artifact.zip -d $ARTIFACT_DIR
          
          # Add the contents of the artifact to your Git repository
          git add $ARTIFACT_DIR
          git commit -m "Add artifact contents to the repository"
          git push origin main
          
          # Create a new GitHub tag
          git tag $TAG_NAME
          git push origin $TAG_NAME --force
